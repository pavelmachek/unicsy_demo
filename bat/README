-*- org -*-

Always fast charging battery to 100% capacity will reduce battery
longevity significantly. Complicating factor is that running out of
battery is very annoying, and battery below 10% capacity also loses
longevity (very significantly around 0%).

So... we can do better, and this is my attempt. Simple idea is to
simply charge to 80%, use "batman norm" to do that.

But we can do better. You can add time when you want phone to be
ready, and it will try to figure optimal charging profile so that
phone is at 80% when requested. Use "batman 15:30" if you want phone
to be at half past three.

Code is at https://github.com/pavelmachek/unicsy_demo/tree/master/bat .

#librem5

Charge modes

| max     | I payed for 100% of battery and I'm going to use it                                                             |
| norm    | simply always charge to 80%                                                                                     |
| eco     | Charge to 60%..80% percent. Good if you only need 40% of your battery (and can usually keep battery above 20%)  |
| min     | Keep charge at 50%. Good for long-term storage or running at AC power, when you don't need your battery at all. |
| readyby | Make sure battery is 80% by specified time.                                                                     |


L5 can limit charge voltage to 3.9V and above
	setting "charge to 3.8V will actually discharge battery if it is below 3.8V".
	running on AC power can be achieved by setting 4V, 0A limit
D4 can limit charge voltage to 4.1V, but not 4.0V
Droidian on OnePlus 6 is "special":
         /sys/class/power_supply/usb/voltage_now -- input voltage on USB, but wrong by factor of 1000
	 /sys/class/power_supply/bms/constant_charge_voltage -- seems to have no effect
	 /sys/class/power_supply/battery/charging_enabled -- can be used to toggle charging on/off
	 	-- but does not allow system power from USB, so not too useful

Give me table between state of charge (volts) and battery longevity (years). Go down to 0%.

(robot says:)


Approximate Relationship Between State of Charge and Longevity

(Assuming room temperature, moderate cycling, full charge/discharge counted as 1 cycle)

| S. of Charge | Cell Voltage    | Typical Longevity (years, calendar life + cycle life)   |
|         100% | 4.20 V          | ~2–3 years (fast aging, high stress)                    |
|          90% | 4.15 V          | ~3–4 years                                              |
|          80% | 4.05 V          | ~4–5 years                                              |
|          70% | 3.95 V          | ~5–6 years                                              |
|          60% | 3.87 V          | ~6–7 years                                              |
|          50% | 3.80 V          | ~7–8 years (sweet spot, minimal stress)                 |
|          40% | 3.75 V          | ~7–8 years                                              |
|          30% | 3.70 V          | ~6–7 years                                              |
|          20% | 3.60 V          | ~5–6 years                                              |
|          10% | 3.50 V          | ~3–4 years (deep cycling starts to hurt)                |
|           0% | (cutoff) <3.0 V | Permanent damage risk if stored; cell may die in months |

Give me longevity vs. charge current (or maybe C) table.

⚠ Reality filter:

C-rate = charge current ÷ nominal capacity (e.g., 1C = charging a 2000 mAh cell at 2000 mA).

Higher charge rates cause more heat, lithium plating, and SEI growth, which shorten cycle life.

Numbers below are approximate for typical consumer Li-ion (NMC / LiPo) cells, based on published test data. Actual results vary by chemistry and cooling.


⚡ Approximate Effect of Charge Current on Longevity

| Charge Rate (C)             | (for 2 Ah cell) | Life (to 80% capacity) | Longevity (daily use)  | Notes                                             |
| 0.2C (gentle)               | 400 mA          | ~1500–2000 cycles      | 6–8 years              | Very safe, minimal heating, but slow              |
| 0.5C (moderate)             | 1000 mA         | ~1000–1500 cycles      | 4–6 years              | Common in laptops, some phones                    |
| 1C (standard fast charge)   | 2000 mA         | ~500–800 cycles        | 2–4 years              | Typical “fast charge” baseline                    |
| 2C (aggressive fast charge) | 4000 mA         | ~300–500 cycles        | 1–2 years              | Higher heat, lithium plating risk                 |
| 3C+ (extreme fast charge)   | ≥6000 mA        | <200–300 cycles        | <1 year                | Only tolerable with special chemistries + cooling |

0.1C / 0.05C may be slightly better than 0.2C, but advantages are
diminishing after that.


Model constants / multipliers (illustrative)
Calendar base: = 1.0 × 10^-4   damage/day (baseline at 25 °C, 50% SOC).
SOC factor: = (U-shaped):
10% → 1.2, 25% → 1.1, 50% → 1.0 (sweet spot), 70% → 1.5, 80% → 2.0, 90% → 3.0, 100% → 4.0.
Temperature factor: Q10 ≈ 2 (damage doubles every +10 °C; at 25 °C → 1.0).
Cycle base: =1/7000 ≈ 1.4286×10^-4 damage per EFC (equivalent full cycle).
Charge-rate factor: ≤0.2C → 1.0, 0.5C → 1.2, 1C → 1.6, 2C → 2.5, >2C → 3.5.
CV multiplier (per-mAh cycle damage):  =3.0 (CV mAh ~3× worse than CC).

